# CHTL项目详细分析文档

## 项目概述
CHTL是基于C++语言实现的超文本语言，其本质是为了提供一种更符合开发者编写HTML代码的方式，使用MIT开源协议。

## 文档结构分析

### 第一部分：基础语法 (1-96行)
1. **注释系统** (4-9行)
   - `//` 单行注释
   - `/**/` 多行注释  
   - `--` 生成器识别注释

2. **文本节点** (11-29行)
   - `text { }` 语法
   - `text: "内容"` 属性语法

3. **字面量** (31-45行)
   - 无修饰字面量（无引号字符串）
   - 双引号字符串 `""`
   - 单引号字符串 `''`

4. **CE对等式** (47-50行)
   - `:` 与 `=` 完全等价

5. **元素节点** (52-78行)
   - 支持所有HTML元素
   - 单标签、双标签、块级、行内、行内块元素

6. **属性** (81-95行)
   - `属性名 : "属性值";` 语法

### 第二部分：样式系统 (97-307行)
1. **局部样式块** (97-101行)
   - 元素内部嵌套 `style {}`
   - 内联样式、类选择器、id选择器、伪类选择器、伪元素选择器

2. **内联样式** (103-119行)
   - 直接在 `style{}` 内部添加CSS属性

3. **自动化类名/id** (121-137行)
   - 自动添加类名/id
   - 无需手动编写class/id

4. **上下文推导** (139-167行)
   - `&` 表示类名/id
   - 根据上下文推导

5. **属性运算** (169-173行)
   - 支持算术运算符 `+ - * / % **`
   - 直接进行属性值运算

6. **引用属性** (175-208行)
   - 引用其他元素的属性值
   - 语法：`CSS选择器.属性`

7. **属性条件表达式** (210-306行)
   - 三元运算符：`条件 ? 选项 : 选项`
   - 链式调用
   - 可选选项
   - 算术运算符
   - 逻辑运算符 `&&` `||`
   - 引用属性条件表达式

### 第三部分：模板系统 (308-437行)
1. **样式组模板** (312-329行)
   - `[Template] @Style 组名` 语法
   - `@Style 组名` 使用

2. **元素模板** (331-370行)
   - `[Template] @Element 元素名` 语法
   - `@Element 元素名` 使用

3. **变量组模板** (372-403行)
   - `[Template] @Var 变量组名` 语法
   - `变量组名(变量名)` 使用

4. **组合继承** (405-437行)
   - 模板继承
   - 显性继承 `inherit`

### 第四部分：自定义系统 (439-735行)
1. **自定义样式组** (446-537行)
   - 无值样式组
   - 样式组特例化
   - 删除属性 `delete`
   - 删除样式组继承

2. **自定义元素** (539-735行)
   - 自定义元素特例化
   - 增加样式
   - 索引访问 `[index]`
   - 插入元素 `insert`
   - 删除元素 `delete`

3. **变量组** (737-753行)
   - 变量组特例化

4. **全缀名** (755-779行)
   - 解决命名冲突

### 第五部分：原始嵌入 (781-832行)
1. **嵌入HTML代码** (788-802行)
   - `[Origin] @Html` 语法

2. **嵌入CSS代码** (804-810行)
   - `[Origin] @Style` 语法

3. **嵌入JS代码** (812-818行)
   - `[Origin] @JavaScript` 语法

4. **带名原始嵌入** (820-832行)
   - 为原始嵌入块赋予名称

### 第六部分：导入系统 (834-1018行)
1. **导入HTML、CSS、JS文件** (838-851行)
   - `[Import] @Html from 路径 as 命名`
   - `[Import] @Style from 路径 as 命名`
   - `[Import] @JavaScript from 路径 as 命名`

2. **导入CHTL文件** (853-911行)
   - 精确导入
   - 类型导入
   - 通配导入

3. **路径对等式** (911-913行)
   - `.` 与 `/` 等价

### 第七部分：命名空间 (914-1018行)
1. **创建命名空间** (920-950行)
   - `[Namespace] 空间名` 语法

2. **命名空间嵌套** (952-1015行)
   - 嵌套命名空间
   - 同名命名空间自动合并

### 第八部分：约束系统 (1020-1055行)
1. **精确约束** (1023-1031行)
   - `except` 关键字

2. **类型约束** (1033-1042行)
   - 禁止特定类型

3. **全局约束** (1045-1055行)
   - 命名空间内全局约束

### 第九部分：配置系统 (1057-1245行)
1. **配置组** (1057-1069行)
   - `[Configuration]` 语法

2. **Name配置** (1072-1129行)
   - 自定义关键字名称

3. **命名配置组** (1132-1149行)
   - 命名配置组

4. **导入配置组** (1151-1158行)
   - 导入配置

5. **局部样式块自动化规则** (1160-1176行)
   - 禁用自动添加类/id

6. **默认命名空间** (1177-1185行)
   - 禁用默认命名空间

7. **自定义原始嵌入类型** (1187-1228行)
   - 创建自定义类型

### 第十部分：use语法 (1229-1245行)
1. **HTML5类型** (1233-1238行)
   - `use html5;`

2. **使用命名配置组** (1240-1245行)
   - `use @Config 配置组名;`

### 第十一部分：CHTL JS (1247-1573行)
1. **文件后缀** (1256-1257行)
   - `*.cjjs` 文件

2. **文件载入** (1259-1280行)
   - `fileloader {}` 语法

3. **局部script** (1282-1313行)
   - 元素内部 `script{}`

4. **增强选择器** (1315-1365行)
   - `{{CSS选择器}}` 语法

5. **明确使用CHTL语法** (1366-1387行)
   - `->` 代替 `.`

6. **增强监听器** (1389-1420行)
   - `listen` 语法

7. **事件委托** (1422-1440行)
   - `delegate` 语法

8. **动画** (1441-1481行)
   - `animate` 语法

9. **虚对象** (1483-1518行)
   - `vir` 语法

10. **路由** (1519-1548行)
    - `router` 语法

11. **动态属性条件表达式** (1550-1572行)
    - 动态属性条件

### 第十二部分：模块系统 (1574-1913行)
1. **模块路径** (1575-1587行)
   - 源码文件夹、官方模块目录、用户模块目录

2. **CMOD** (1588-1692行)
   - 模块结构
   - 模块信息
   - 包含子模块
   - 模块导入

3. **CJMOD** (1693-1752行)
   - 模块结构
   - 模块信息
   - 包含子模块
   - 模块导入

4. **CMOD + CJMOD** (1754-1786行)
   - 混合模块结构

5. **通配符** (1787-1908行)
   - 通配符导入

6. **官方模块** (1800-1913行)
   - 官方模块前缀
   - Chtholly模块
   - Yuigahama模块

### 第十三部分：项目结构 (1914-2012行)
1. **项目结构建议** (1914-1964行)
   - 文件夹结构
   - 组件组织

2. **项目流程** (1966-2012行)
   - 编译流程
   - 编译器对应关系

### 第十四部分：语法边界 (2022-2030行)
1. **全局样式块语法** (2023行)
2. **script语法** (2025-2026行)
3. **局部样式块语法** (2027行)
4. **局部script语法** (2029行)

### 第十五部分：CJMOD API (2031-2407行)
1. **简介** (2032-2035行)
2. **CJMOD API** (2036-2242行)
   - Syntax类
   - Arg类
   - CJMODScanner类
   - CJMODGenerator类
   - AtomArg类
   - CHTLJSFunction类
3. **扫描算法** (2244-2254行)
4. **统一扫描器** (2255-2407行)

### 第十六部分：CLI和IDE (2408-2441行)
1. **CLI** (2408-2417行)
2. **VSCode IDE** (2418-2441行)

## 技术栈选择建议
基于文档分析，建议使用以下技术栈：
1. **主要语言**: Rust (高性能、内存安全)
2. **备选语言**: Zig (如果Rust不可用)
3. **CSS编译器**: 推荐使用libcss或sassc
4. **JS编译器**: 推荐使用V8或QuickJS
5. **构建系统**: Cargo (Rust) 或 Zig build system
6. **测试框架**: Rust内置测试框架

## 核心实现挑战
1. **统一扫描器**: 需要精确分离CHTL、CHTL JS、CSS、JS代码
2. **占位符机制**: 实现无痛代码分离
3. **模板系统**: 复杂的继承和特例化
4. **CHTL JS编译器**: 独立的编程语言实现
5. **模块系统**: CMOD和CJMOD的复杂结构
6. **CJMOD API**: 强大的扩展能力

## 实现优先级
1. **Phase 1**: 基础语法解析器
2. **Phase 2**: 样式系统
3. **Phase 3**: 模板系统
4. **Phase 4**: 自定义系统
5. **Phase 5**: 导入和命名空间
6. **Phase 6**: CHTL JS编译器
7. **Phase 7**: 模块系统
8. **Phase 8**: CJMOD API
9. **Phase 9**: CLI和IDE支持